# Подготовка

1. Установку на DO делает Terraform, основной файл: thundermint-do-docker.tf
1. Необходимо сгенерировать DO-ключ, чтобы Terraform мог с его помощью подключаться к DO API.
1. DO недоступен иногда из РФ, желательно использовать VPN, чтобы установка проходила гладко.
1. В DO надо разместить ssh-ключи для того, чтобы DO мог запускать дроплеты с этим ключами, а Terraform мог с их помощью
   закидывать файлы на дроплеты.
1. Должен быть поднят ssh-agent, чтобы Terraform мог раскидать файлы по дроплетам.
    1. Либо в thundermint-do-docker.tf в секцию `connection` надо явно указать путь к приватному ключу и отключить
       доступ к ssh-agent, например:
    ```
      private_key = "${file("/home/dima/.ssh/id_rsa")}"
      agent = false
    ```
1. Логи отправляются в elasticsearch по https c basic auth. Поэтому надо иметь учетные данные (username/password) или запросить их у @romcheck.

# Запуск

1. Отправить комиты в github.
1. Дождаться успешного билда CI
1. Выполнить `terraform apply`, который
   развернет `thundermint-coin-node` на N дроплетах в DO (где N — количство приватных ключей). Если были предыдущие развертывания — выполнить `terraform destroy'.
   1. Чтобы Terraform не спрашивал DO-ключ, можно сделать: `export TF_VAR_dotoken=DO-ключ`.
1. Все логи доступны в [kibana](https://elastic.hxr.team/kibana) в индексе thundermin-*.

# Примечания

1. Terraform обычно удаляет и запускает ноды снова (destroy/apply). Поэтому они каждый раз имеют разные ip-адреса.
1. Текущие ip-адреса развернутых нод можно увидеть в `terraform.state-файле`.
1. Взаимодействие идет по протоколу IPv4. Можно включить поддержку IPv6 следующим образом:
   1. На одном уровне с image, size добавить `ipv6=true`.
   1. Строку `ipv4_address` заменить на ipv6_address 
